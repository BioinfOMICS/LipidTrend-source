<!DOCTYPE html><html><head><title>R: Choose Span for Local-Weighted Regression Smoothing</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script>
const macros = { "\\R": "\\textsf{R}", "\\mbox": "\\text", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R.css">
</head><body><div class="container"><main>

<table style="width: 100%;"><tr><td>chooseLowessSpan {limma}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Choose Span for Local-Weighted Regression Smoothing</h2>

<h3>Description</h3>

<p>Choose an optimal span, depending on the number of points, for lowess smoothing of variance trends.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>chooseLowessSpan(n=1000, small.n=50, min.span=0.3, power=1/3)
</code></pre>


<h3>Arguments</h3>

<table role = "presentation">
<tr><td><code id="n">n</code></td>
<td>
<p>the number of points the lowess curve will be applied to.</p>
</td></tr>
<tr><td><code id="small.n">small.n</code></td>
<td>
<p>the span will be set to 1 for any <code>n</code> less than or equal to this value.</p>
</td></tr>
<tr><td><code id="min.span">min.span</code></td>
<td>
<p>the minimum span for large <code>n</code>.</p>
</td></tr>
<tr><td><code id="power">power</code></td>
<td>
<p>numeric power between 0 and 1 that determines how fast the chosen span decreases with <code>n</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The span is the proportion of points used for each of the local regressions.
When there a few points, a large span should be used to ensure a smooth curve.
When there are a large number of points, smaller spans can be used because each span window still contains good coverage.
By default, the chosen span decreases as the cube-root of the number of points, a rule that is motivated by analogous rules to choose the number of bins for a histogram (Scott, 1979; Freedman &amp; Diaconis, 1981; Hyndman, 1995).
</p>
<p>The span returned is
<code>min.span + (1-min.span) * (small.n/n)^power</code>
except that the span is set to 1 for any <code>n</code> less than <code>small.n</code>.
Note that the fitted lowess curve will still estimate a trend (i.e., will not be constant) even if <code>span=1</code>.
</p>
<p>The function is tuned for smoothing of mean-variance trends, for which the trend is usually monotonic, so preference is given to moderately large spans.
Even for the very large datasets, the span is always greater than <code>min.span</code>.
</p>
<p>This function is used to create adaptive spans for <code>voom</code>, <code>vooma</code> and <code>voomaLmFit</code> where <code>n</code> is the number of genes in the analysis.
</p>


<h3>Value</h3>

<p>A numeric vector of length 1 containing the span value.
</p>


<h3>Author(s)</h3>

<p>Gordon Smyth</p>


<h3>References</h3>

<p>Freedman, D. and Diaconis, P. (1981). On the histogram as a density estimator: L_2 theory.
<em>Zeitschrift fur Wahrscheinlichkeitstheorie und verwandte Gebiete</em> 57, 453-476.
</p>
<p>Hyndman, R. J. (1995). The problem with Sturges' rule for constructing histograms.
<a href="https://robjhyndman.com/papers/sturges.pdf">https://robjhyndman.com/papers/sturges.pdf</a>.
</p>
<p>Scott, D. W. (1979). On optimal and data-based histograms.
<em>Biometrika</em> 66, 605-610.
</p>


<h3>See Also</h3>

<p><code><a href="../../limma/help/loessFit.html">loessFit</a></code>, <code><a href="../../limma/help/weightedLowess.html">weightedLowess</a></code>, <code><a href="../../stats/html/lowess.html">lowess</a></code>, <code><a href="../../stats/html/loess.html">loess</a></code>.
</p>
<p><code><a href="../../limma/help/vooma.html">vooma</a></code>, <code><a href="../../limma/help/eBayes.html">eBayes</a></code>, <code><a href="../../limma/help/squeezeVar.html">squeezeVar</a></code>, <code><a href="../../limma/help/fitFDistRobustly.html">fitFDistRobustly</a></code>.
</p>


<h3>Examples</h3>

<pre><code class='language-R'>chooseLowessSpan(100)
chooseLowessSpan(1e6)

n &lt;- 10:5000
span &lt;- chooseLowessSpan(n)
plot(n,span,type="l",log="x")
</code></pre>

<hr><div style="text-align: center;">[Package <em>limma</em> version 3.66.0 <a href="00Index.html">Index</a>]</div></main>

</div>
</body></html>
